name: Publish Documentation

on:
  push:
    tags:
      - 'v*' # Triggers on tags like v1.0, v2.1.3, etc.

permissions:
  contents: write # REQUIRED: Allows the bot to write to the gh-pages branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # REQUIRED: Fetch all history for mike to manage branches

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: |
          pip install mkdocs-material mkdocs-static-i18n mike
          # If you have other plugins in mkdocs.yml, add them here

      - name: Configure Git User
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Extract Version Name
        id: extract_version
        shell: bash
        run: |
          # Takes 'refs/tags/v1.2.0' and converts it to '1.2'
          # This keeps your URLs clean (e.g., /1.2/ instead of /v1.2.0/)
          TAG_NAME=${GITHUB_REF#refs/tags/}
          VERSION=${TAG_NAME#v}  # Remove 'v' prefix
          MAJOR_MINOR=$(echo "$VERSION" | cut -d. -f1,2) # Keep only 1.0 from 1.0.5
          
          echo "version=$MAJOR_MINOR" >> $GITHUB_OUTPUT
          echo "Deploying version: $MAJOR_MINOR"

      - name: Deploy with Mike
        run: |
          # Deploys the version (e.g., 1.0) and updates the 'latest' alias
          mike deploy ${{ steps.extract_version.outputs.version }} latest --push --update-aliases